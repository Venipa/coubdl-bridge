/*! // ==UserScript==
// @name         Coub-Bridge
// @namespace    https://venipa.net
// @version      0.1.7
// @description  try to take over the world!
// @author       Venipa
// @match        https://*.coub.com/*
// @match        https://coub.com/*
// @grant        none
// @license GPL-3.0-or-later; http://www.gnu.org/licenses/gpl-3.0.txt
// ==/UserScript==
// ==OpenUserJS==
// @author Venipa
// ==/OpenUserJS== */
!function(e){var r={};function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)t.d(n,o,function(r){return e[r]}.bind(null,o));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="/",t(t.s=0)}([function(e,r,t){e.exports=t(1)},function(e,r){function t(e){return function(e){if(Array.isArray(e)){for(var r=0,t=new Array(e.length);r<e.length;r++)t[r]=e[r];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}!function(){var e=function(){var e=document.createElement("a");return e.innerText="Download",e.style.padding="8px 12px",e.style.color="#fff",e.style.background="#000",e.style.lineHeight=1,e.style.fontSize="0.875rem",e.style.alignSelf="center",e.style.borderRadius="4px",e.style.marginRight="8px",e},r=function(e){for(var r=arguments.length,t=new Array(r>1?r-1:0),n=1;n<r;n++)t[n-1]=arguments[n];console.log("[coub-bridge|debug] ",e,t)};r("boot");var n=function(t){r(t),t.filter((function(e){return e.querySelectorAll})).forEach((function(r){var t=r.querySelector(".description__controls");if(t&&t.querySelectorAll){if(0===t.querySelectorAll("#coubdl-download").length){var n=r.getAttribute("data-permalink"),o=e();o.href="coubdl-bridge://"+n,o.innerText="Download";var l=e();l.href="coubdl-bridge://"+n+"/full",l.innerText="Looped";var i=function(){var e=document.createElement("div");e.style.width="2px",e.style.backgroundColor="rgba(255,255,255,.25)",e.style.borderRadius="18px",e.style.height="18px";var r=document.createElement("div");r.style.color="#fff",r.style.background="#000",r.style.lineHeight=1,r.style.fontSize="0.875rem",r.style.alignSelf="center",r.style.borderRadius="4px",r.style.flexDirection="row",r.style.overflow="hidden";for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return n.length>0&&n.map((function(e){return e.style.borderRadius="0",e.style.margin="0",e.style.flexDirection="row",e})).forEach((function(t,n){(n+1)%2==0&&r.appendChild(e),r.appendChild(t)})),r}(o,l);i.id="coubdl-download",t.prepend(i)}if(0===t.querySelectorAll("#coubdl-audio-download").length){var u=r.getAttribute("data-permalink"),a=e();a.id="coubdl-audio-download",a.innerText="Audio",a.href="coubdl-bridge://"+u+"/audio",t.prepend(a)}if(0===t.querySelectorAll("#coubdl-gif-download").length){var c=r.getAttribute("data-permalink"),d=e();d.id="coubdl-gif-download",d.innerText="GIF",d.href="coubdl-bridge://"+c+"/gif",t.prepend(d)}}}))},o=new MutationObserver((function(e){var r;if((r=e.filter((function(e){return e.addedNodes&&e.addedNodes.length>0})).map((function(e){return e.addedNodes})).reduce((function(e,r){return[].concat(t(e),t(r))}),[])).length>0&&r){console.log(r);var o=r.filter((function(e){return["coub","coub-page","viewer__video","page","coub--normal-card"].filter((function(r){var t;return null===(t=e.classList)||void 0===t?void 0:t.contains(r)}))}));o.length>0&&n(o)}}));new MutationObserver((function(e){o.disconnect();var l=Array.from(document.querySelectorAll(".coub.coub--page-card,.coub.coub--timeline,.coubs-list__inner .page"));r(["start el",l]),n(l),e.filter((function(e){var r;return null===(r=e.addedNodes)||void 0===r?void 0:r.length})).map((function(e){return e.addedNodes})).reduce((function(e,r){return[].concat(t(e),[r])})).forEach((function(e){o.observe(e)}))})).observe(document.documentElement,{attributes:!0,characterData:!0,childList:!0,subtree:!0});var l=Array.from(document.querySelectorAll(".coub.coub--page-card,.coub.coub--timeline,.coubs-list__inner .page"));r(["start el",l]),n(l)}()}]);